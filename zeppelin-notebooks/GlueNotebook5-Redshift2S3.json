{"paragraphs":[{"text":"%pyspark\n## GlueNotebook1 - Unload data from Redshift to S3 in Parquet.\nprint spark.version\nsys.argv=[\"redshift2s3.py\",\"--JOB_NAME\",\"Redshift2S3\",\"--TempDir\",\"s3://neilawsglue/temp\"]","user":"admin","dateUpdated":"2017-11-01T12:58:27+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"2.1.0\n"}]},"apps":[],"jobName":"paragraph_1509540542924_858749403","id":"20171101-124902_1870803377","dateCreated":"2017-11-01T12:49:02+0000","dateStarted":"2017-11-01T12:58:27+0000","dateFinished":"2017-11-01T12:58:27+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:425"},{"text":"%pyspark\nimport sys, boto3\nfrom awsglue.transforms import *\nfrom awsglue.utils import getResolvedOptions\nfrom pyspark.context import SparkContext\nfrom awsglue.context import GlueContext\nfrom awsglue.job import Job\n\nargs = getResolvedOptions(sys.argv, ['TempDir','JOB_NAME'])\n\nsc=sc if 'sc' in vars() else SparkContext()\nglueContext = GlueContext(sc)\nspark = glueContext.spark_session\njob = Job(glueContext)\njob.init(args['JOB_NAME'], args)","user":"admin","dateUpdated":"2017-11-01T12:58:27+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1509540642101_-950569788","id":"20171101-125042_1992296365","dateCreated":"2017-11-01T12:50:42+0000","dateStarted":"2017-11-01T12:58:27+0000","dateFinished":"2017-11-01T12:58:28+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:426"},{"text":"%pyspark\n### *** CHANGE THESE VARIABLES *** ###\nregion='us-east-1'\nglue_endpoint_url=\"https://glue.us-east-1.amazonaws.com\"\n\ntarget_database='RedShift'\ntarget_table_1='public.sales_order_fact'\n\n## Specify a writable S3 location\ns3_output_location=\"s3://neilawstemp/dataset231\"","user":"admin","dateUpdated":"2017-11-01T12:58:27+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1509540825476_-445334830","id":"20171101-125345_287824317","dateCreated":"2017-11-01T12:53:45+0000","dateStarted":"2017-11-01T12:58:27+0000","dateFinished":"2017-11-01T12:58:28+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:427"},{"text":"%pyspark\ntarget_database='RedShift'\ntarget_table_1='public.sales_order_fact'\n \nglue=boto3.client(service_name='glue', region_name='us-east-1',\n                       endpoint_url='https://glue.us-east-1.amazonaws.com')\nredshiftConnection=glue.get_connection(Name=target_database)\n \njdbc_url=redshiftConnection['Connection']['ConnectionProperties']['JDBC_CONNECTION_URL']\nusername= redshiftConnection['Connection']['ConnectionProperties']['USERNAME']\npassword= redshiftConnection['Connection']['ConnectionProperties']['PASSWORD']","user":"admin","dateUpdated":"2017-11-01T12:58:28+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1509540683261_491530386","id":"20171101-125123_1504199410","dateCreated":"2017-11-01T12:51:23+0000","dateStarted":"2017-11-01T12:58:28+0000","dateFinished":"2017-11-01T12:58:28+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:428"},{"text":"%pyspark\njdbc_url=jdbc_url+'?user='+username+'&password='+password\ndf = spark.read \\\n    .format(\"com.databricks.spark.redshift\") \\\n    .option(\"url\", jdbc_url) \\\n    .option(\"dbtable\", \"SALES_ORDER_FACT\") \\\n    .option(\"tempdir\", args[\"TempDir\"]) \\\n    .option(\"jdbcdriver\", \"com.amazon.redshift.jdbc41.Driver\") \\\n    .load()","user":"admin","dateUpdated":"2017-11-01T12:58:28+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1509540701022_608356134","id":"20171101-125141_1426234552","dateCreated":"2017-11-01T12:51:41+0000","dateStarted":"2017-11-01T12:58:28+0000","dateFinished":"2017-11-01T12:58:30+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:429"},{"text":"%pyspark\npartitionby = ['ship_mode']\ncodec='snappy'\ndf.repartition(*partitionby).write.partitionBy(partitionby).mode(\"append\").parquet(s3_output_location, compression=codec)\n ","user":"admin","dateUpdated":"2017-11-01T12:58:29+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1509540716499_-520112390","id":"20171101-125156_1894092305","dateCreated":"2017-11-01T12:51:56+0000","dateStarted":"2017-11-01T12:58:29+0000","dateFinished":"2017-11-01T12:59:05+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:430"},{"text":"%pyspark\njob.commit();\n## Glue Job ends here","user":"admin","dateUpdated":"2017-11-01T12:58:30+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1509540723776_665699045","id":"20171101-125203_1223590821","dateCreated":"2017-11-01T12:52:03+0000","dateStarted":"2017-11-01T12:58:30+0000","dateFinished":"2017-11-01T12:59:05+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:431"},{"text":"%pyspark\n","user":"admin","dateUpdated":"2017-11-01T12:58:27+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1509540964692_-479746048","id":"20171101-125604_902713554","dateCreated":"2017-11-01T12:56:04+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:432"}],"name":"GlueNotebook5-Redshift2S3","id":"2CX7UUEDB","angularObjects":{"2CRE5X63N:shared_process":[],"2CQZ9JC8F:shared_process":[],"2CNAPD13W:shared_process":[],"2CQ1X8PFU:shared_process":[],"2CNFC7TNE:shared_process":[],"2CMQ2EHTE:shared_process":[],"2CQUCJVJA:shared_process":[],"2CQY3SUDK:shared_process":[],"2CNA37GFQ:shared_process":[],"2CRC324G8:shared_process":[],"2CPH9H73W:shared_process":[],"2CR2XFEE3:shared_process":[],"2CQ9YVF7W:shared_process":[],"2CP1P36EU:shared_process":[],"2CMR9MKCE:shared_process":[],"2CR2YZBFW:shared_process":[],"2CPJK4U6W:shared_process":[],"2CR2Z9UR2:shared_process":[],"2CPQWHWM3:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}